<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/cart.css" />
    <link rel="stylesheet" href="../css/admin.css" />
  </head>
  <body>
    <div class="all">
      <div>
        <div class="background">
          <h1>VEGETABLE</h1>
          <br />

          <p>Quản lí user</p>
          <br />

          <p>Quản lí product</p>
          <br />

          <p>Quản lí bill</p>
        </div>
      </div>
      <div class="tbl">
        <h1>Giỏ hàng của bạn</h1>
        <table border="1px">
          <tr>
            <th>STT</th>
            <th>Tên sản phẩm</th>
            <th>Sản phẩm</th>
            <th>Giá</th>
            <th>số lượng</th>
            <th>Tổng</th>
            <th>tt</th>
          </tr>
          <tbody id="cart-items"></tbody>
        </table>
      </div>
    </div>
  </body>

  <script>
    // Lấy dữ liệu giỏ hàng từ localStorage
    let users = JSON.parse(localStorage.getItem("user"));
    let checkLogin = JSON.parse(localStorage.getItem("userLogin"));
    let cartItems = users.find((user) => user.userId === checkLogin)?.cart;

    // Hiển thị sản phẩm trong giỏ hàng
    if (cartItems) {
      const cartItemsContainer = document.getElementById("cart-items");

      cartItems.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td><img src="${item.image}" alt="" /></td>
                    <td>${item.giá}</td>
                    <td>
                        <button onclick="decreaseQuantity(${index})">-</button>
                        <span id="quantity-${index}">1</span>
                        <button onclick="increaseQuantity(${index})">+</button>
                    </td>
                    <td><span id="total-${index}"></span></td>
                    <td><button onclick="removeItem(${index})">xóa</button></td>
                `;

        cartItemsContainer.appendChild(row);
      });
    }


    
function updateCart() {
  // Tìm user hiện tại trong danh sách users
  const currentUser = users.find((user) => user.userId === checkLogin);

  // Cập nhật giỏ hàng của user
  currentUser.cart = cartItems;

  // Lưu lại users vào localStorage
  localStorage.setItem("user", JSON.stringify(users));
}

    // hàm tính tổng giá sản phẩm đã thêm
    function decreaseQuantity(index) {
  const quantityElement = document.getElementById(`quantity-${index}`);
  let quantity = parseInt(quantityElement.textContent);

  if (quantity > 1) {
    quantity--;
    quantityElement.textContent = quantity;

    updateTotalPrice(index, quantity);
  }
}

function increaseQuantity(index) {
  const quantityElement = document.getElementById(`quantity-${index}`);
  let quantity = parseInt(quantityElement.textContent);

  quantity++;
  quantityElement.textContent = quantity;

  updateTotalPrice(index, quantity);
}

function updateTotalPrice(index, quantity) {
  const totalPriceElement = document.getElementById(`total-${index}`);
  const item = cartItems[index];
  const totalPrice = item.giá * quantity;
  totalPriceElement.textContent = totalPrice;

  // Cập nhật giá trị tổng trong giỏ hàng
  item.tổng = totalPrice;

  // // // Lưu lại giỏ hàng vào localStorage
  // localStorage.setItem("user", JSON.stringify(users));
}
  </script>
</html>
